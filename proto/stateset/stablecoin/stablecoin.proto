syntax = "proto3";
package stateset.stablecoin;

option go_package = "github.com/stateset/core/x/stablecoin/types";

import "gogoproto/gogo.proto";
import "cosmos_proto/cosmos.proto";
import "cosmos/base/v1beta1/coin.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/duration.proto";

// CollateralParam defines risk limits for a collateral type.
message CollateralParam {
  string denom = 1;
  string liquidation_ratio = 2 [
    (cosmos_proto.scalar) = "cosmos.Dec",
    (gogoproto.customtype) = "cosmossdk.io/math.LegacyDec",
    (gogoproto.nullable) = false
  ];
  string stability_fee = 3 [
    (cosmos_proto.scalar) = "cosmos.Dec",
    (gogoproto.customtype) = "cosmossdk.io/math.LegacyDec",
    (gogoproto.nullable) = false
  ];
  string debt_limit = 4 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  bool active = 5;
}

// Params contains global vault parameters.
message Params {
  repeated CollateralParam collateral_params = 1 [(gogoproto.nullable) = false];
  bool vault_minting_enabled = 2;
}

// Vault tracks a collateralized debt position for ssUSD issuance.
message Vault {
  uint64 id = 1;
  string owner = 2;
  cosmos.base.v1beta1.Coin collateral = 3 [
    (gogoproto.nullable) = false,
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Coin"
  ];
  string collateral_denom = 4;
  string debt = 5 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  int64 last_accrued = 6;
}

// TokenizedTreasuryConfig defines an approved tokenized treasury token.
message TokenizedTreasuryConfig {
  string denom = 1;
  string issuer = 2;
  string underlying_type = 3;
  bool active = 4;
  uint32 haircut_bps = 5;
  uint32 max_allocation_bps = 6;
  string oracle_denom = 7;
}

// ReserveParams defines reserve-backed stablecoin policy.
message ReserveParams {
  uint32 min_reserve_ratio_bps = 1;
  uint32 target_reserve_ratio_bps = 2;
  uint32 mint_fee_bps = 3;
  uint32 redeem_fee_bps = 4;
  string min_mint_amount = 5 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  string min_redeem_amount = 6 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  google.protobuf.Duration redemption_delay = 7 [
    (gogoproto.nullable) = false,
    (gogoproto.stdduration) = true
  ];
  string max_daily_mint = 8 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  string max_daily_redeem = 9 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  repeated TokenizedTreasuryConfig tokenized_treasuries = 10 [(gogoproto.nullable) = false];
  bool require_kyc = 11;
  bool mint_paused = 12;
  bool redeem_paused = 13;
}

// Reserve represents the on-chain reserve backing for ssUSD.
message Reserve {
  repeated cosmos.base.v1beta1.Coin total_deposited = 1 [
    (gogoproto.nullable) = false,
    (gogoproto.castrepeated) = "github.com/cosmos/cosmos-sdk/types.Coins"
  ];
  string total_value = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  string total_minted = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  int64 last_updated = 4 [(gogoproto.customname) = "LastUpdatedHeight"];
  google.protobuf.Timestamp last_updated_time = 5 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// ReserveDeposit represents a deposit of approved tokenized treasuries.
message ReserveDeposit {
  uint64 id = 1;
  string depositor = 2;
  cosmos.base.v1beta1.Coin amount = 3 [
    (gogoproto.nullable) = false,
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Coin"
  ];
  string usd_value = 4 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  string ssusd_minted = 5 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  google.protobuf.Timestamp deposited_at = 6 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
  string status = 7;
}

// RedemptionRequest represents a request to redeem ssUSD into reserve assets.
message RedemptionRequest {
  uint64 id = 1;
  string requester = 2;
  string ssusd_amount = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  string output_denom = 4;
  google.protobuf.Timestamp requested_at = 5 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
  google.protobuf.Timestamp executable_after = 6 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
  string status = 7;
  google.protobuf.Timestamp executed_at = 8 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
  cosmos.base.v1beta1.Coin output_amount = 9 [
    (gogoproto.nullable) = false,
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Coin"
  ];
}

// DailyMintStats tracks daily minting/redemption totals.
message DailyMintStats {
  string date = 1;
  string total_minted = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  string total_redeemed = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
}

// OffChainReserveAttestation represents an off-chain reserve attestation.
message OffChainReserveAttestation {
  uint64 id = 1;
  string attester = 2;
  string total_cash = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  string total_tbills = 4 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  string total_tnotes = 5 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  string total_tbonds = 6 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  string total_repos = 7 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  string total_mmf = 8 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  string total_value = 9 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  string custodian_name = 10;
  string audit_firm = 11;
  google.protobuf.Timestamp report_date = 12 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
  string attestation_hash = 13;
  google.protobuf.Timestamp timestamp = 14 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// TotalReserves aggregates on-chain and off-chain reserves.
message TotalReserves {
  string on_chain_value = 1 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  string off_chain_value = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  string total_value = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  string total_supply = 4 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  uint32 reserve_ratio_bps = 5;
  google.protobuf.Timestamp last_on_chain_update = 6 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
  google.protobuf.Timestamp last_off_chain_update = 7 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// ============================================================================
// Peg Stability Module (PSM)
// ============================================================================

// PSMConfig defines configuration for a PSM asset (e.g., USDC, USDT).
message PSMConfig {
  // denom is the token denomination (e.g., "ibc/USDC_HASH").
  string denom = 1;
  // active indicates whether the PSM accepts this asset.
  bool active = 2;
  // mint_fee_bps is the fee charged when minting ssUSD from this asset (in basis points).
  uint32 mint_fee_bps = 3;
  // redeem_fee_bps is the fee charged when redeeming ssUSD for this asset (in basis points).
  uint32 redeem_fee_bps = 4;
  // debt_ceiling is the maximum ssUSD that can be minted against this asset.
  string debt_ceiling = 5 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  // oracle_denom is the oracle price feed identifier for this asset.
  string oracle_denom = 6;
}

// PSMState tracks the current state of a PSM asset.
message PSMState {
  // denom is the token denomination.
  string denom = 1;
  // total_deposited is the total amount of this asset in the PSM.
  string total_deposited = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  // total_minted is the total ssUSD minted against this asset.
  string total_minted = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
}

// ============================================================================
// Savings Rate (ssSR)
// ============================================================================

// SavingsParams defines parameters for the ssUSD savings rate.
message SavingsParams {
  // enabled indicates whether the savings rate is active.
  bool enabled = 1;
  // savings_rate_bps is the annual percentage yield in basis points (e.g., 500 = 5% APY).
  uint32 savings_rate_bps = 2;
  // min_deposit is the minimum ssUSD deposit amount.
  string min_deposit = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  // accrual_interval is how often interest accrues (in seconds).
  int64 accrual_interval_seconds = 4;
}

// SavingsDeposit represents a user's savings deposit.
message SavingsDeposit {
  // depositor is the address of the depositor.
  string depositor = 1;
  // principal is the original deposited amount.
  string principal = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  // accrued_interest is the accumulated interest.
  string accrued_interest = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  // last_accrual_time is the timestamp of the last interest accrual.
  google.protobuf.Timestamp last_accrual_time = 4 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
  // deposited_at is when the deposit was created.
  google.protobuf.Timestamp deposited_at = 5 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// SavingsStats tracks global savings statistics.
message SavingsStats {
  // total_deposits is the total ssUSD in savings.
  string total_deposits = 1 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  // total_interest_paid is the cumulative interest paid out.
  string total_interest_paid = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  // depositor_count is the number of unique depositors.
  uint64 depositor_count = 3;
}

// ============================================================================
// Dutch Auction Liquidations
// ============================================================================

// AuctionStatus represents the status of a Dutch auction.
enum AuctionStatus {
  AUCTION_STATUS_UNSPECIFIED = 0;
  AUCTION_STATUS_ACTIVE = 1;
  AUCTION_STATUS_COMPLETED = 2;
  AUCTION_STATUS_EXPIRED = 3;
  AUCTION_STATUS_CANCELLED = 4;
}

// DutchAuction represents a Dutch auction for liquidated collateral.
message DutchAuction {
  // id is the unique auction identifier.
  uint64 id = 1;
  // vault_id is the ID of the liquidated vault.
  uint64 vault_id = 2;
  // owner is the original vault owner.
  string owner = 3;
  // collateral is the collateral being auctioned.
  cosmos.base.v1beta1.Coin collateral = 4 [
    (gogoproto.nullable) = false,
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Coin"
  ];
  // debt_to_cover is the ssUSD debt that must be covered.
  string debt_to_cover = 5 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  // start_price is the initial price (in ssUSD per unit of collateral).
  string start_price = 6 [
    (cosmos_proto.scalar) = "cosmos.Dec",
    (gogoproto.customtype) = "cosmossdk.io/math.LegacyDec",
    (gogoproto.nullable) = false
  ];
  // end_price is the minimum price (floor).
  string end_price = 7 [
    (cosmos_proto.scalar) = "cosmos.Dec",
    (gogoproto.customtype) = "cosmossdk.io/math.LegacyDec",
    (gogoproto.nullable) = false
  ];
  // started_at is when the auction started.
  google.protobuf.Timestamp started_at = 8 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
  // duration is the auction duration.
  google.protobuf.Duration duration = 9 [
    (gogoproto.nullable) = false,
    (gogoproto.stdduration) = true
  ];
  // status is the current auction status.
  AuctionStatus status = 10;
  // collateral_sold is the amount of collateral already sold.
  string collateral_sold = 11 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  // debt_raised is the ssUSD raised so far.
  string debt_raised = 12 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
}

// AuctionParams defines parameters for Dutch auctions.
message AuctionParams {
  // enabled indicates whether Dutch auctions are active.
  bool enabled = 1;
  // duration is the default auction duration.
  google.protobuf.Duration duration = 2 [
    (gogoproto.nullable) = false,
    (gogoproto.stdduration) = true
  ];
  // start_price_multiplier_bps is the multiplier for starting price (e.g., 13000 = 130% of oracle price).
  uint32 start_price_multiplier_bps = 3;
  // end_price_multiplier_bps is the multiplier for ending price (e.g., 8000 = 80% of oracle price).
  uint32 end_price_multiplier_bps = 4;
  // liquidation_penalty_bps is the penalty charged on liquidation (e.g., 1300 = 13%).
  uint32 liquidation_penalty_bps = 5;
}

// ============================================================================
// Flash Minting
// ============================================================================

// FlashMintParams defines parameters for flash minting.
message FlashMintParams {
  // enabled indicates whether flash minting is active.
  bool enabled = 1;
  // fee_bps is the flash mint fee in basis points (e.g., 9 = 0.09%).
  uint32 fee_bps = 2;
  // max_flash_mint is the maximum amount that can be flash minted per tx.
  string max_flash_mint = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
}

// FlashMintStats tracks flash mint statistics.
message FlashMintStats {
  // total_flash_minted is the cumulative flash mint volume.
  string total_flash_minted = 1 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
  // total_fees_collected is the cumulative fees collected.
  string total_fees_collected = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];
}
